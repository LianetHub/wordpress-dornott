(() => { "use strict"; if ($(".preloader").length > 0) { let e = setInterval(function () { let t = $("#percentage"), i = parseInt(t.text()); i < 90 ? t.text(++i) : i < 95 && "interactive" === document.readyState ? t.text(95) : i < 99 && "complete" === document.readyState && t.text(99), i >= 99 && "complete" === document.readyState && (clearInterval(e), t.text(100), setTimeout(function () { $("body").removeClass("preloading").addClass("is-loaded") }, 300)) }, 20) } $(function () { "undefined" != typeof Fancybox && null !== Fancybox && Fancybox.bind("[data-fancybox]", { dragToClose: !1, on: { ready: e => { const t = e.getSlide(); if ("#policies" === t.src) { const e = $(t.el), i = t.triggerEl; if (i) { const t = i.getAttribute("href").replace("#", ""), a = e.find(`input[name="policy-type"][value="${t}"]`); a.length ? a.prop("checked", !0).trigger("change") : e.find('input[name="policy-type"]:checked').trigger("change"), setTimeout(() => { a.length ? a.prop("checked", !0).trigger("change") : e.find('input[name="policy-type"]:checked').trigger("change") }, 300) } } } } }); const e = { Android: () => /Android/i.test(navigator.userAgent), BlackBerry: () => /BlackBerry/i.test(navigator.userAgent), iOS: () => /iPhone|iPad|iPod/i.test(navigator.userAgent), Opera: () => /Opera Mini/i.test(navigator.userAgent), Windows: () => /IEMobile/i.test(navigator.userAgent), any: function () { return this.Android() || this.BlackBerry() || this.iOS() || this.Opera() || this.Windows() } }; function t() { e.any() || $(window).width() < 992 ? $("body").removeClass("_pc").addClass("_touch") : $("body").removeClass("_touch").addClass("_pc") } function i() { const e = $(".steps__item"); e.off("click mouseenter mouseleave"), $("body").hasClass("_pc") ? e.on("mouseenter", function () { $(this).addClass("active").siblings().removeClass("active") }) : e.on("click", function (e) { $(this).addClass("active").siblings().removeClass("active") }) } t(), i(), $(window).on("resize", () => { clearTimeout(window.resizeTimer), window.resizeTimer = setTimeout(() => { t(), i() }, 100) }), $(document).on("click", e => { const t = $(e.target); t.closest(".header__menu-toggler").length && ($(".header__menu-toggler").toggleClass("active"), $(".header").toggleClass("open-mobile-menu"), $("body").toggleClass("lock-mobile-menu")), !t.closest(".header").length && $(".header").hasClass("open-mobile-menu") && ($(".header__menu-toggler").removeClass("active"), $(".header").removeClass("open-mobile-menu"), $("body").removeClass("lock-mobile-menu")), t.closest(".favorite-btn").length && t.closest(".favorite-btn").toggleClass("active") }); var a = document.querySelectorAll('input[type="tel"]'), n = function (e) { return e.value.replace(/\D/g, "") }, r = function (e) { var t = e.target, i = n(t), a = e.clipboardData || window.clipboardData; if (a) { var r = a.getData("Text"); if (/\D/g.test(r)) return void (t.value = i) } }, s = function (e) { var t = e.target, i = n(t), a = t.selectionStart, r = ""; if (!i) return t.value = ""; if (t.value.length == a) { if (["7", "8", "9"].indexOf(i[0]) > -1) { "9" == i[0] && (i = "7" + i); var s = "8" == i[0] ? "8" : "+7"; r = t.value = s + " ", i.length > 1 && (r += "(" + i.substring(1, 4)), i.length >= 5 && (r += ") " + i.substring(4, 7)), i.length >= 8 && (r += "-" + i.substring(7, 9)), i.length >= 10 && (r += "-" + i.substring(9, 11)) } else r = "+" + i.substring(0, 16); t.value = r } else e.data && /\D/g.test(e.data) && (t.value = i) }, o = function (e) { var t = e.target.value.replace(/\D/g, ""); 8 == e.keyCode && 1 == t.length && (e.target.value = "") }; for (var c of a) c.addEventListener("keydown", o), c.addEventListener("input", s, !1), c.addEventListener("paste", r, !1); const l = { type: "fraction", formatFractionCurrent: e => e < 10 ? "0" + e : e, formatFractionTotal: e => e < 10 ? "0" + e : e, renderFraction: (e, t) => '<span class="' + e + '"></span>/<span class="' + t + '"></span>' }; if ($(".hero").length) { const e = $(".hero__images"), t = $(".hero__offer-slider"); if (e.length && t.length) { const i = new Swiper(e.get(0), { loop: !0, effect: "fade", fadeEffect: { crossFade: !0 }, speed: 600, allowTouchMove: !1, navigation: { nextEl: ".hero__next", prevEl: ".hero__prev" }, pagination: { el: ".hero__pagination", ...l } }), a = new Swiper(t.get(0), { loop: !0, speed: 600, effect: "fade", fadeEffect: { crossFade: !0 }, controller: { control: i } }); i.controller.control = a } } if ($(".product-card").length && $(".product-card").each(function (e, t) { const i = $(t).find(".product-card__slider"); if (!i.length) return; const a = $(t).find(".product-card__pagination")[0], n = new Swiper(i[0], { slidesPerView: 1, speed: 0, lazy: !0, watchOverflow: !0, pagination: { el: a, clickable: !0 } }), r = n.slides.length; if (r > 1) { const e = $('<div class="product-card__hover-areas"></div>'); e.css({ position: "absolute", top: 0, left: 0, right: 0, bottom: 0, display: "flex", zIndex: 10 }); for (let t = 0; t < r; t++) { const i = $('<div class="product-card__hover-area"></div>'); i.css({ flex: "1 1 0" }), i.on("mouseenter", () => { n.slideTo(t) }), e.append(i) } i.css("position", "relative").append(e) } }), $(".reviews").length) { let e; const t = () => { $(".reviews__text .reviews__slider").length && !e && (e = new Swiper(".reviews__text .reviews__slider", { slidesPerView: 1, spaceBetween: 24, watchOverflow: !0, navigation: { nextEl: ".reviews__controls--text .reviews__next", prevEl: ".reviews__controls--text .reviews__prev" }, pagination: { el: ".reviews__controls--text .reviews__pagination", ...l }, breakpoints: { 1199.98: { slidesPerView: 4 } } })) }; let i; const a = () => { $(".reviews__screenshots .reviews__slider").length && !i && (i = new Swiper(".reviews__screenshots .reviews__slider", { slidesPerView: 1, spaceBetween: 24, watchOverflow: !0, navigation: { nextEl: ".reviews__controls--screenshots .reviews__next", prevEl: ".reviews__controls--screenshots .reviews__prev" }, pagination: { el: ".reviews__controls--screenshots .reviews__pagination", ...l }, breakpoints: { 768: { slidesPerView: 2 }, 1024: { slidesPerView: 5 } } })) }, n = $("#reviews"), r = n.find('.reviews__switcher input[name="reviews-type"]'), s = n.find(".reviews__text"), o = n.find(".reviews__screenshots"), c = n.find(".reviews__controls--text"), d = n.find(".reviews__controls--screenshots"); "text" === r.filter(":checked").val() ? t() : a(), r.on("change", function () { const n = $(this).val(); "text" === n ? (s.show(), o.hide(), c.show(), d.hide(), t()) : "screenshots" === n && (s.hide(), o.show(), c.hide(), d.show(), a()), e && e.update(), i && i.update() }) } $(document).on("change", ".product-card .product-card__variations-input", function () { var e = $(this).closest(".product-card"), t = $(this).val(), i = $(this).data("price-html"), a = $(this).data("regular-price-html"), n = !$(this).is(":disabled"), r = e.find('[data-price-role="current-price"]'), s = e.find('[data-price-role="regular-price"]'), o = e.find(".ajax_add_to_cart"); r.html(i), s.html(a), o.data("variation-id", t), n ? o.removeAttr("disabled") : o.attr("disabled", "disabled") }), $(".product-card").each(function () { var e = $(this).find(".product-card__variations-input:checked"); e.length && e.trigger("change") }), $(document).on("change", '#policies input[name="policy-type"]', function () { const e = $(this), t = e.closest("#policies"), i = t.find(".switcher__item").index(e.closest(".switcher__item")); t.find(".popup__text").hide().eq(i).show() }); const d = $(".header"); new IntersectionObserver(function (e, t) { e[0].isIntersecting ? d.removeClass("scroll") : d.addClass("scroll") }).observe(d[0]), $(".switcher").each(function () { var e, t = $(this), i = $('<div class="switcher__slider"></div>'); function a(e) { if (t.is(":visible")) { var i = e.next(".switcher__btn"); if (i.length) { var a = i.outerWidth(), n = i.offset().left - t.offset().left - parseFloat(t.css("padding-left")); t.css("--active-width", a + "px"), t.css("--active-offset", n + "px") } } } t.prepend(i), new ResizeObserver(function (e) { for (var i of e) if (i.contentRect.width > 0 || i.contentRect.height > 0) { var n = t.find(".switcher__input:checked"); n.length && a(n) } }).observe(t[0]), t.on("change", ".switcher__input", function () { a($(this)) }), $(window).on("resize", function () { clearTimeout(e), e = setTimeout(function () { var e = t.find(".switcher__input:checked"); e.length && a(e) }, 150) }) }); var h = !1; $(window).scroll(function () { let e = $("#map"); if (!h && e.length > 0) { let t = document.createElement("script"); t.async = !0, t.defer = !0, t.src = "https://api-maps.yandex.ru/2.1/?lang=ru_RU"; let i = e.offset().top - $(window).height() - 200; $(this).scrollTop() > i && (document.head.append(t), t.onload = function () { !function () { const e = $("#map"); for (var t = e.data("coords").split("; "), i = e.data("placemark-logo"), a = 0; a < t.length; a++) { t[a] = t[a].split(", "); for (var n = 0; n < t[a].length; n++)t[a][n] = parseFloat(t[a][n]) } var r = t[0].map(function (e) { return e }); ymaps.ready(function () { var e = new ymaps.Map("map", { center: r, zoom: 16, controls: [] }), a = new ymaps.Placemark(t[0], {}, { iconLayout: "default#image", iconImageHref: i, iconImageSize: [69, 78], iconImageOffset: [-35, -78] }), n = new ymaps.control.ZoomControl({ options: { position: { right: 10, top: 200 } } }); e.behaviors.disable("scrollZoom"), e.controls.add(n), e.geoObjects.add(a) }) }() }, h = !0) } }), window.formController = new class { constructor() { this.selectors = { field: ".form__field", errorClass: "_error", loadingClass: "_loading", requiredAttr: "[data-required]", fileInput: ".form__file-input", fileContainer: ".form__file", fileRemove: ".form__file-remove", submitBtn: '[type="submit"]' }, this.init() } init() { const e = this; $("form").each(function () { e.bindSubmit($(this)) }), $(document).on("input change", this.selectors.requiredAttr, e => { const t = $(e.target); (t.hasClass(this.selectors.errorClass) || t.closest(this.selectors.field).hasClass(this.selectors.errorClass)) && this.toggleErrorState(t, !0) }), $(document).on("keydown", 'input[type="tel"]', e => this.onPhoneKeyDown(e)), $(document).on("input", 'input[type="tel"]', e => this.onPhoneInput(e)), $(document).on("paste", 'input[type="tel"]', e => this.onPhonePaste(e)), $(document).off("change", this.selectors.fileInput).on("change", this.selectors.fileInput, e => this.handleFileChange(e)), $(document).off("click", this.selectors.fileRemove).on("click", this.selectors.fileRemove, e => this.handleFileRemove(e)) } bindSubmit(e) { e.on("submit", async t => { t.preventDefault(), this.validateForm(e) && await this.sendForm(e) }) } async sendForm(e) { const t = e.attr("action"), i = e.attr("method") || "POST", a = new FormData(e[0]), n = e.find(this.selectors.submitBtn); n.addClass(this.selectors.loadingClass); try { const n = await fetch(t, { method: i, body: a }); n.ok ? (await n.json(), e[0].reset(), e.find(".form__file-preview").remove(), e.find(".uploaded").removeClass("uploaded"), window.dornottCart && "cart-form" === e.attr("id") && (localStorage.removeItem(window.dornottCart.storageKey), window.dornottCart.updateInterface()), Fancybox.show([{ src: "#success-submitting", type: "inline" }])) : (console.error("Ошибка сервера"), Fancybox.show([{ src: "#error-submitting", type: "inline" }])) } catch (e) { console.error("Ошибка сети", e), Fancybox.show([{ src: "#error-submitting", type: "inline" }]) } finally { n.removeClass(this.selectors.loadingClass) } } validateField(e) { if (!e.is(":visible")) return this.toggleErrorState(e, !0), !0; const t = e.attr("type"), i = e.attr("name"), a = e.val() ? e.val().trim() : ""; let n = !0; return n = "checkbox" === t ? e.is(":checked") : "username" === i ? /^[^\d]+$/.test(a) && a.length > 1 : "tel" === t ? a.replace(/\D/g, "").length >= 11 : "email" === t ? /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a) : "city" === i ? a.length >= 2 : "address" === i ? a.length >= 5 : "" !== a, this.toggleErrorState(e, n), n } toggleErrorState(e, t) { e.closest(this.selectors.field).toggleClass(this.selectors.errorClass, !t), e.toggleClass(this.selectors.errorClass, !t) } validateForm(e) { let t = !0; const i = this; return e.find(this.selectors.requiredAttr).each(function () { i.validateField($(this)) || (t = !1) }), t } handleFileChange(e) { const t = $(e.currentTarget).closest(this.selectors.fileContainer), i = e.target.files[0]; if (t.find(".form__file-preview").remove(), t.removeClass("uploaded"), i) { const e = i.type.match("image.*"), a = new FileReader; a.onload = a => { let n = ""; e && (n = `\n                        <span class="form__file-image">\n                            <img src="${a.target.result}" alt="Превью" class="cover-image">\n                        </span>\n                    `); const r = `\n                    <div class="form__file-preview">\n                        ${n}\n                        <span class="form__file-name">${i.name}</span>\n                        <button type="button" aria-label="Удалить" class="form__file-remove icon-cross"></button>\n                    </div>\n                `; t.append(r), t.addClass("uploaded") }, a.readAsDataURL(i) } } handleFileRemove(e) { e.preventDefault(), e.stopPropagation(); const t = $(e.currentTarget), i = t.closest(this.selectors.fileContainer), a = t.closest(".form__file-preview"); i.find(this.selectors.fileInput).val(""), i.removeClass("uploaded"), a.remove() } onPhoneInput(e) { let t = e.target, i = t.value.replace(/\D/g, ""), a = t.selectionStart, n = ""; if (!i) return t.value = ""; t.value.length == a ? (["7", "8", "9"].indexOf(i[0]) > -1 ? ("9" == i[0] && (i = "7" + i), n = ("8" == i[0] ? "8" : "+7") + " ", i.length > 1 && (n += "(" + i.substring(1, 4)), i.length >= 5 && (n += ") " + i.substring(4, 7)), i.length >= 8 && (n += "-" + i.substring(7, 9)), i.length >= 10 && (n += "-" + i.substring(9, 11))) : n = "+" + i.substring(0, 16), t.value = n) : e.originalEvent.data && /\D/g.test(e.originalEvent.data) && (t.value = i) } onPhoneKeyDown(e) { let t = e.target.value.replace(/\D/g, ""); 8 == e.keyCode && 1 == t.length && (e.target.value = "") } onPhonePaste(e) { let t = e.target, i = t.value.replace(/\D/g, ""), a = e.originalEvent.clipboardData || window.clipboardData; if (a) { let e = a.getData("Text"); /\D/g.test(e) && (t.value = i) } } }, window.dornottCart = new class { constructor() { this.storageKey = "dornott_cart", this.$form = $("#cart-form"), this.$container = $("#cart-items-container"), this.$headerCart = $(".header__action.icon-cart"), this.$addressStep = this.$form.find(".order__step").eq(2), this.init() } init() { this.bindEvents(), this.updateInterface(), this.toggleAddressStep() } getData() { return JSON.parse(localStorage.getItem(this.storageKey)) || [] } saveData(e) { localStorage.setItem(this.storageKey, JSON.stringify(e)), this.updateInterface() } bindEvents() { $(document).on("click", ".toggle-to-cart-button", e => this.handleAddToCart(e)), $(document).on("click", ".quantity-block__up", e => this.changeQty(e, 1)), $(document).on("click", ".quantity-block__down", e => this.changeQty(e, -1)), $(document).on("change", ".quantity-block__input", e => this.handleQtyInput(e)), $(document).on("click", ".cart__item-remove", e => { const t = $(e.target).closest(".cart__item").data("id"); this.removeItem(t) }), $(document).on("change", 'input[name="delivery"]', () => { this.updateInterface(), this.toggleAddressStep() }), $(document).on("change", 'input[name="select_all"]', e => this.toggleAllCheckboxes(e)), $(document).on("change", ".cart__item-checkbox .checkbox__input", () => this.updateSelectAllState()), $(document).on("click", ".cart__clear", () => this.removeSelected()), $(document).on("change", ".product-card__variations-input", e => this.handleVariationChange(e)), this.$form.on("submit", e => this.handleSubmit(e)), this.$form.on("input change", "[data-required]", () => this.validateForm()) } handleAddToCart(e) { const t = $(e.currentTarget), i = t.closest(".product-card"), a = t.data("variation-id") || t.data("product-id"); if (t.hasClass("active")) this.removeItem(a), t.removeClass("active"); else { const e = parseInt(i.find('[data-price-role="current-price"]').text().replace(/\D/g, "")), n = parseInt(i.find('[data-price-role="regular-price"]').text().replace(/\D/g, "")) || e, r = i.find(".price-block__sale").text().trim(), s = { id: a, name: i.find(".product-card__title").text().trim(), sku: i.find(".product-card__sku").text().trim(), price: e, regular_price: n, sale_label: r, image: i.find(".product-card__image").first().attr("src"), quantity: 1 }; this.addItem(s), t.addClass("active") } } addItem(e) { let t = this.getData(); -1 === t.findIndex(t => t.id === e.id) && t.push(e), this.saveData(t) } removeItem(e) { let t = this.getData(); t = t.filter(t => t.id !== e), this.saveData(t), $(`.toggle-to-cart-button[data-product-id="${e}"], .toggle-to-cart-button[data-variation-id="${e}"]`).removeClass("active") } changeQty(e, t) { const i = $(e.currentTarget).siblings(".quantity-block__input"), a = $(e.currentTarget).closest(".cart__item").data("id"); let n = parseInt(i.val()) || 1; n = Math.min(999, Math.max(1, n + t)), i.val(n), this.updateQuantity(a, n) } handleQtyInput(e) { const t = $(e.currentTarget), i = t.closest(".cart__item").data("id"); let a = parseInt(t.val().replace(/\D/g, "")) || 1; a = Math.min(999, Math.max(1, a)), t.val(a), this.updateQuantity(i, a) } updateQuantity(e, t) { let i = this.getData(); const a = i.findIndex(t => t.id === e); a > -1 && (i[a].quantity = t, this.saveData(i)) } validateForm() { let e = !0; return this.$form.find("[data-required]").each((t, i) => { window.formController && !window.formController.validateField($(i)) && (e = !1) }), $("#cart-validation-warning").toggleClass("hidden", e), e } toggleAllCheckboxes(e) { const t = $(e.currentTarget).is(":checked"); $(".cart__item-checkbox .checkbox__input").prop("checked", t) } updateSelectAllState() { const e = $(".cart__item-checkbox .checkbox__input").length, t = $(".cart__item-checkbox .checkbox__input:checked").length; $('input[name="select_all"]').prop("checked", e === t && e > 0) } removeSelected() { $(".cart__item-checkbox .checkbox__input:checked").each((e, t) => { this.removeItem($(t).closest(".cart__item").data("id")) }) } handleVariationChange(e) { const t = $(e.currentTarget), i = t.closest(".product-card"), a = i.find(".toggle-to-cart-button"); i.find('[data-price-role="current-price"]').html(t.data("price-html")), i.find('[data-price-role="regular-price"]').html(t.data("regular-price-html")); const n = t.val(); a.data("variation-id", n); const r = this.getData(); a.toggleClass("active", r.some(e => e.id == n)) } calculateTotals() { const e = this.getData(), t = parseInt($('input[name="delivery"]:checked').data("price")) || 0; let i = 0, a = 0, n = 0; return e.forEach(e => { i += e.regular_price * e.quantity, a += (e.regular_price - e.price) * e.quantity, n += e.quantity }), { subtotal: i, discount: a, totalQty: n, deliveryPrice: t, finalPrice: i - a + t } } updateInterface() { const e = this.getData(), t = this.calculateTotals(); e.length > 0 ? (this.$form.show(), $("#cart-empty-state").hide(), this.$headerCart.find(".header__action-quantity").length || this.$headerCart.append('<span class="header__action-quantity"></span>'), this.$headerCart.find(".header__action-quantity").text(t.totalQty)) : (this.$form.hide(), $("#cart-empty-state").show(), this.$headerCart.find(".header__action-quantity").remove()), $("#total-qty").text(`${t.totalQty} шт.`), $("#subtotal-price").text(`${t.subtotal.toLocaleString()} ₽`), $("#total-discount").text(`${t.discount.toLocaleString()} ₽`), $("#delivery-price").text(`${t.deliveryPrice.toLocaleString()} ₽`), $("#final-price").text(`${t.finalPrice.toLocaleString()} ₽`), this.renderItems(e), this.syncButtons(e) } toggleAddressStep() { "pickup" === $('input[name="delivery"]:checked').val() ? (this.$addressStep.hide(), this.$addressStep.find("." + window.formController.selectors.errorClass).removeClass(window.formController.selectors.errorClass)) : this.$addressStep.show() } syncButtons(e) { $(".toggle-to-cart-button").each((t, i) => { const a = $(i), n = a.data("variation-id") || a.data("product-id"); a.toggleClass("active", e.some(e => e.id == n)) }) } renderItems(e) { this.$container.empty(), e.forEach(e => { this.$container.append(`\n                <div class="cart__item" data-id="${e.id}">\n                    <div class="cart__item-block">\n                        <label class="cart__item-checkbox checkbox">\n                            <input type="checkbox" class="checkbox__input hidden" hidden checked>\n                            <span class="checkbox__text"></span>\n                        </label>\n                        <div class="cart__item-thumb"><img src="${e.image}"></div>\n                        <div class="cart__item-info">\n                            <div class="cart__item-sku">${e.sku}</div>\n                            <div class="cart__item-name">${e.name}</div>\n                        </div>\n                    </div>\n                    <div class="cart__item-block">\n                        <div class="cart__item-quantity quantity-block">\n                            <button type="button" class="quantity-block__down icon-minus"></button>\n                            <input type="text" class="quantity-block__input" value="${e.quantity}">\n                            <button type="button" class="quantity-block__up icon-plus"></button>\n                        </div>\n                    </div>\n                    <div class="cart__item-block">\n                        <div class="cart__item-price price-block">\n                            <div class="price-block__header">\n                                <div class="price-block__old">${e.regular_price > e.price ? e.regular_price.toLocaleString() + " ₽" : ""}</div>\n                                <div class="price-block__sale">${e.sale_label || ""}</div>\n                            </div>\n                            <div class="price-block__current">${e.price.toLocaleString()} ₽</div>\n                        </div>\n                        <button type="button" class="cart__item-remove icon-cross"></button>\n                    </div>\n                </div>\n            `) }), this.updateSelectAllState() } handleSubmit(e) { if (e.preventDefault(), this.validateForm()) { const e = { order_info: this.$form.serializeArray().filter(e => "select_all" !== e.name), items: this.getData(), totals: this.calculateTotals() }; console.log("Final Payload:", e) } } } }) })();