(()=>{"use strict";if($(".preloader").length>0){let e=setInterval(function(){let t=$("#percentage"),a=parseInt(t.text());a<90?t.text(++a):a<95&&"interactive"===document.readyState?t.text(95):a<99&&"complete"===document.readyState&&t.text(99),a>=99&&"complete"===document.readyState&&(clearInterval(e),t.text(100),setTimeout(function(){$("body").removeClass("preloading").addClass("is-loaded")},300))},20)}$(function(){"undefined"!=typeof Fancybox&&null!==Fancybox&&Fancybox.bind("[data-fancybox]",{dragToClose:!1,on:{ready:e=>{const t=e.getSlide();if("#policies"===t.src){const e=$(t.el),a=t.triggerEl;if(a){const t=a.getAttribute("href").replace("#",""),i=e.find(`input[name="policy-type"][value="${t}"]`);i.length?i.prop("checked",!0).trigger("change"):e.find('input[name="policy-type"]:checked').trigger("change"),setTimeout(()=>{i.length?i.prop("checked",!0).trigger("change"):e.find('input[name="policy-type"]:checked').trigger("change")},300)}}}}});const e={Android:()=>/Android/i.test(navigator.userAgent),BlackBerry:()=>/BlackBerry/i.test(navigator.userAgent),iOS:()=>/iPhone|iPad|iPod/i.test(navigator.userAgent),Opera:()=>/Opera Mini/i.test(navigator.userAgent),Windows:()=>/IEMobile/i.test(navigator.userAgent),any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()}};function t(){e.any()||$(window).width()<992?$("body").removeClass("_pc").addClass("_touch"):$("body").removeClass("_touch").addClass("_pc")}function a(){const e=$(".steps__item");e.off("click mouseenter mouseleave"),$("body").hasClass("_pc")?e.on("mouseenter",function(){$(this).addClass("active").siblings().removeClass("active")}):e.on("click",function(e){$(this).addClass("active").siblings().removeClass("active")})}t(),a(),$(window).on("resize",()=>{clearTimeout(window.resizeTimer),window.resizeTimer=setTimeout(()=>{t(),a()},100)}),$(document).on("click",e=>{const t=$(e.target);t.closest(".header__menu-toggler").length&&($(".header__menu-toggler").toggleClass("active"),$(".header").toggleClass("open-mobile-menu"),$("body").toggleClass("lock-mobile-menu")),!t.closest(".header").length&&$(".header").hasClass("open-mobile-menu")&&($(".header__menu-toggler").removeClass("active"),$(".header").removeClass("open-mobile-menu"),$("body").removeClass("lock-mobile-menu")),t.closest(".favorite-btn").length&&t.closest(".favorite-btn").toggleClass("active")});var i=document.querySelectorAll('input[type="tel"]'),n=function(e){return e.value.replace(/\D/g,"")},r=function(e){var t=e.target,a=n(t),i=e.clipboardData||window.clipboardData;if(i){var r=i.getData("Text");if(/\D/g.test(r))return void(t.value=a)}},o=function(e){var t=e.target,a=n(t),i=t.selectionStart,r="";if(!a)return t.value="";if(t.value.length==i){if(["7","8","9"].indexOf(a[0])>-1){"9"==a[0]&&(a="7"+a);var o="8"==a[0]?"8":"+7";r=t.value=o+" ",a.length>1&&(r+="("+a.substring(1,4)),a.length>=5&&(r+=") "+a.substring(4,7)),a.length>=8&&(r+="-"+a.substring(7,9)),a.length>=10&&(r+="-"+a.substring(9,11))}else r="+"+a.substring(0,16);t.value=r}else e.data&&/\D/g.test(e.data)&&(t.value=a)},s=function(e){var t=e.target.value.replace(/\D/g,"");8==e.keyCode&&1==t.length&&(e.target.value="")};for(var c of i)c.addEventListener("keydown",s),c.addEventListener("input",o,!1),c.addEventListener("paste",r,!1);const l={type:"fraction",formatFractionCurrent:e=>e<10?"0"+e:e,formatFractionTotal:e=>e<10?"0"+e:e,renderFraction:(e,t)=>'<span class="'+e+'"></span>/<span class="'+t+'"></span>'};if($(".hero").length){const e=$(".hero__images"),t=$(".hero__offer-slider");if(e.length&&t.length){const a=new Swiper(e.get(0),{loop:!0,effect:"fade",fadeEffect:{crossFade:!0},speed:600,allowTouchMove:!1,navigation:{nextEl:".hero__next",prevEl:".hero__prev"},pagination:{el:".hero__pagination",...l}}),i=new Swiper(t.get(0),{loop:!0,speed:600,effect:"fade",fadeEffect:{crossFade:!0},controller:{control:a}});a.controller.control=i}}if($(".product-card").length&&$(".product-card").each(function(e,t){const a=$(t).find(".product-card__slider");if(!a.length)return;const i=$(t).find(".product-card__pagination")[0],n=new Swiper(a[0],{slidesPerView:1,speed:0,lazy:!0,watchOverflow:!0,pagination:{el:i,clickable:!0}}),r=n.slides.length;if(r>1){const e=$('<div class="product-card__hover-areas"></div>');e.css({position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",zIndex:10});for(let t=0;t<r;t++){const a=$('<div class="product-card__hover-area"></div>');a.css({flex:"1 1 0"}),a.on("mouseenter",()=>{n.slideTo(t)}),e.append(a)}a.css("position","relative").append(e)}}),$(".reviews").length){let e;const t=()=>{$(".reviews__text .reviews__slider").length&&!e&&(e=new Swiper(".reviews__text .reviews__slider",{slidesPerView:1,spaceBetween:24,watchOverflow:!0,navigation:{nextEl:".reviews__controls--text .reviews__next",prevEl:".reviews__controls--text .reviews__prev"},pagination:{el:".reviews__controls--text .reviews__pagination",...l},breakpoints:{1199.98:{slidesPerView:4}}}))};let a;const i=()=>{$(".reviews__screenshots .reviews__slider").length&&!a&&(a=new Swiper(".reviews__screenshots .reviews__slider",{slidesPerView:1,spaceBetween:24,watchOverflow:!0,navigation:{nextEl:".reviews__controls--screenshots .reviews__next",prevEl:".reviews__controls--screenshots .reviews__prev"},pagination:{el:".reviews__controls--screenshots .reviews__pagination",...l},breakpoints:{768:{slidesPerView:2},1024:{slidesPerView:5}}}))},n=$("#reviews"),r=n.find('.reviews__switcher input[name="reviews-type"]'),o=n.find(".reviews__text"),s=n.find(".reviews__screenshots"),c=n.find(".reviews__controls--text"),d=n.find(".reviews__controls--screenshots");"text"===r.filter(":checked").val()?t():i(),r.on("change",function(){const n=$(this).val();"text"===n?(o.show(),s.hide(),c.show(),d.hide(),t()):"screenshots"===n&&(o.hide(),s.show(),c.hide(),d.show(),i()),e&&e.update(),a&&a.update()})}$(document).on("change",".product-card .product-card__variations-input",function(){var e=$(this).closest(".product-card"),t=$(this).val(),a=$(this).data("price-html"),i=$(this).data("regular-price-html"),n=!$(this).is(":disabled"),r=e.find('[data-price-role="current-price"]'),o=e.find('[data-price-role="regular-price"]'),s=e.find(".ajax_add_to_cart");r.html(a),o.html(i),s.data("variation-id",t),n?s.removeAttr("disabled"):s.attr("disabled","disabled")}),$(".product-card").each(function(){var e=$(this).find(".product-card__variations-input:checked");e.length&&e.trigger("change")}),$(document).on("change",'#policies input[name="policy-type"]',function(){const e=$(this),t=e.closest("#policies"),a=t.find(".switcher__item").index(e.closest(".switcher__item"));t.find(".popup__text").hide().eq(a).show()});const d=$(".header");new IntersectionObserver(function(e,t){e[0].isIntersecting?d.removeClass("scroll"):d.addClass("scroll")}).observe(d[0]),$(".switcher").each(function(){var e,t=$(this),a=$('<div class="switcher__slider"></div>');function i(e){if(t.is(":visible")){var a=e.next(".switcher__btn");if(a.length){var i=a.outerWidth(),n=a.offset().left-t.offset().left-parseFloat(t.css("padding-left"));t.css("--active-width",i+"px"),t.css("--active-offset",n+"px")}}}t.prepend(a),new ResizeObserver(function(e){for(var a of e)if(a.contentRect.width>0||a.contentRect.height>0){var n=t.find(".switcher__input:checked");n.length&&i(n)}}).observe(t[0]),t.on("change",".switcher__input",function(){i($(this))}),$(window).on("resize",function(){clearTimeout(e),e=setTimeout(function(){var e=t.find(".switcher__input:checked");e.length&&i(e)},150)})});var h=!1;$(window).scroll(function(){let e=$("#map");if(!h&&e.length>0){let t=document.createElement("script");t.async=!0,t.defer=!0,t.src="https://api-maps.yandex.ru/2.1/?lang=ru_RU";let a=e.offset().top-$(window).height()-200;$(this).scrollTop()>a&&(document.head.append(t),t.onload=function(){!function(){const e=$("#map");for(var t=e.data("coords").split("; "),a=e.data("placemark-logo"),i=0;i<t.length;i++){t[i]=t[i].split(", ");for(var n=0;n<t[i].length;n++)t[i][n]=parseFloat(t[i][n])}var r=t[0].map(function(e){return e});ymaps.ready(function(){var e=new ymaps.Map("map",{center:r,zoom:16,controls:[]}),i=new ymaps.Placemark(t[0],{},{iconLayout:"default#image",iconImageHref:a,iconImageSize:[69,78],iconImageOffset:[-35,-78]}),n=new ymaps.control.ZoomControl({options:{position:{right:10,top:200}}});e.behaviors.disable("scrollZoom"),e.controls.add(n),e.geoObjects.add(i)})}()},h=!0)}}),window.dornottCart=new class{constructor(){this.storageKey="dornott_cart",this.$form=$("#cart-form"),this.$container=$("#cart-items-container"),this.$headerCart=$(".header__action.icon-cart"),this.init()}init(){this.bindEvents(),this.updateInterface()}getData(){return JSON.parse(localStorage.getItem(this.storageKey))||[]}saveData(e){localStorage.setItem(this.storageKey,JSON.stringify(e)),this.updateInterface()}bindEvents(){$(document).on("click",".toggle-to-cart-button",e=>this.handleAddToCart(e)),$(document).on("click",".quantity-block__up",e=>this.changeQty(e,1)),$(document).on("click",".quantity-block__down",e=>this.changeQty(e,-1)),$(document).on("change",".quantity-block__input",e=>this.handleQtyInput(e)),$(document).on("click",".cart__item-remove",e=>{const t=$(e.target).closest(".cart__item").data("id");this.removeItem(t)}),$(document).on("change",'input[name="delivery"]',()=>this.updateInterface()),$(document).on("change",'input[name="select_all"]',e=>this.toggleAllCheckboxes(e)),$(document).on("change",".cart__item-checkbox .checkbox__input",()=>this.updateSelectAllState()),$(document).on("click",".cart__clear",()=>this.removeSelected()),$(document).on("change",".product-card__variations-input",e=>this.handleVariationChange(e)),this.$form.on("submit",e=>this.handleSubmit(e)),this.$form.on("input change","[data-required]",e=>this.validateField($(e.target)))}handleAddToCart(e){const t=$(e.currentTarget),a=t.closest(".product-card"),i=t.data("variation-id")||t.data("product-id");if(t.hasClass("active"))this.removeItem(i),t.removeClass("active");else{const e=parseInt(a.find('[data-price-role="current-price"]').text().replace(/\D/g,"")),n=parseInt(a.find('[data-price-role="regular-price"]').text().replace(/\D/g,""))||e,r=a.find(".price-block__sale").text().trim(),o={id:i,name:a.find(".product-card__title").text().trim(),sku:a.find(".product-card__sku").text().trim(),price:e,regular_price:n,sale_label:r,image:a.find(".product-card__image").first().attr("src"),quantity:1};this.addItem(o),t.addClass("active")}}addItem(e){let t=this.getData();-1===t.findIndex(t=>t.id===e.id)&&t.push(e),this.saveData(t)}removeItem(e){let t=this.getData();t=t.filter(t=>t.id!==e),this.saveData(t),$(`.toggle-to-cart-button[data-product-id="${e}"], .toggle-to-cart-button[data-variation-id="${e}"]`).removeClass("active")}changeQty(e,t){const a=$(e.currentTarget).siblings(".quantity-block__input"),i=$(e.currentTarget).closest(".cart__item").data("id");let n=parseInt(a.val())||1;n=Math.min(999,Math.max(1,n+t)),a.val(n),this.updateQuantity(i,n)}handleQtyInput(e){const t=$(e.currentTarget),a=t.closest(".cart__item").data("id");let i=parseInt(t.val().replace(/\D/g,""))||1;i=Math.min(999,Math.max(1,i)),t.val(i),this.updateQuantity(a,i)}updateQuantity(e,t){let a=this.getData();const i=a.findIndex(t=>t.id===e);i>-1&&(a[i].quantity=t,this.saveData(a))}toggleAllCheckboxes(e){const t=$(e.currentTarget).is(":checked");$(".cart__item-checkbox .checkbox__input").prop("checked",t)}updateSelectAllState(){const e=$(".cart__item-checkbox .checkbox__input").length,t=$(".cart__item-checkbox .checkbox__input:checked").length;$('input[name="select_all"]').prop("checked",e===t&&e>0)}removeSelected(){$(".cart__item-checkbox .checkbox__input:checked").each((e,t)=>{this.removeItem($(t).closest(".cart__item").data("id"))})}handleVariationChange(e){const t=$(e.currentTarget),a=t.closest(".product-card"),i=a.find(".toggle-to-cart-button");a.find('[data-price-role="current-price"]').html(t.data("price-html")),a.find('[data-price-role="regular-price"]').html(t.data("regular-price-html"));const n=t.val();i.data("variation-id",n);const r=this.getData();i.toggleClass("active",r.some(e=>e.id==n))}calculateTotals(){const e=this.getData(),t=parseInt($('input[name="delivery"]:checked').data("price"))||0;let a=0,i=0,n=0;return e.forEach(e=>{a+=e.regular_price*e.quantity,i+=(e.regular_price-e.price)*e.quantity,n+=e.quantity}),{subtotal:a,discount:i,totalQty:n,deliveryPrice:t,finalPrice:a-i+t}}validateField(e){const t=""!==e.val().trim();return e.toggleClass("_error",!t),t}validateForm(){let e=!0;return this.$form.find("[data-required]").each((t,a)=>{this.validateField($(a))||(e=!1)}),$('input[name="policy"]').is(":checked")||(e=!1),$("#cart-validation-warning").toggleClass("hidden",e),e}updateInterface(){const e=this.getData(),t=this.calculateTotals();e.length>0?(this.$form.show(),$("#cart-empty-state").hide(),this.$headerCart.find(".header__action-quantity").length||this.$headerCart.append('<span class="header__action-quantity"></span>'),this.$headerCart.find(".header__action-quantity").text(t.totalQty)):(this.$form.hide(),$("#cart-empty-state").show(),this.$headerCart.find(".header__action-quantity").remove()),$("#total-qty").text(`${t.totalQty} шт.`),$("#subtotal-price").text(`${t.subtotal.toLocaleString()} ₽`),$("#total-discount").text(`${t.discount.toLocaleString()} ₽`),$("#delivery-price").text(`${t.deliveryPrice.toLocaleString()} ₽`),$("#final-price").text(`${t.finalPrice.toLocaleString()} ₽`),this.renderItems(e),this.syncButtons(e)}syncButtons(e){$(".toggle-to-cart-button").each((t,a)=>{const i=$(a),n=i.data("variation-id")||i.data("product-id");i.toggleClass("active",e.some(e=>e.id==n))})}renderItems(e){this.$container.empty(),e.forEach(e=>{this.$container.append(`\n                <div class="cart__item" data-id="${e.id}">\n                    <div class="cart__item-block">\n                        <label class="cart__item-checkbox checkbox">\n                            <input type="checkbox" class="checkbox__input hidden" hidden checked>\n                            <span class="checkbox__text"></span>\n                        </label>\n                        <div class="cart__item-thumb"><img src="${e.image}"></div>\n                        <div class="cart__item-info">\n                            <div class="cart__item-sku">${e.sku}</div>\n                            <div class="cart__item-name">${e.name}</div>\n                        </div>\n                    </div>\n                    <div class="cart__item-block">\n                        <div class="cart__item-quantity quantity-block">\n                            <button type="button" class="quantity-block__down icon-minus"></button>\n                            <input type="text" class="quantity-block__input" value="${e.quantity}">\n                            <button type="button" class="quantity-block__up icon-plus"></button>\n                        </div>\n                    </div>\n                    <div class="cart__item-block">\n                        <div class="cart__item-price price-block">\n                            <div class="price-block__header">\n                                <div class="price-block__old">${e.regular_price>e.price?e.regular_price.toLocaleString()+" ₽":""}</div>\n                                <div class="price-block__sale">${e.sale_label||""}</div>\n                            </div>\n                            <div class="price-block__current">${e.price.toLocaleString()} ₽</div>\n                        </div>\n                        <button type="button" class="cart__item-remove icon-cross"></button>\n                    </div>\n                </div>\n            `)}),this.updateSelectAllState()}handleSubmit(e){if(e.preventDefault(),this.validateForm()){const e={order_info:this.$form.serializeArray().filter(e=>"select_all"!==e.name),items:this.getData(),totals:this.calculateTotals()};console.log("Final Payload:",e)}}}})})();